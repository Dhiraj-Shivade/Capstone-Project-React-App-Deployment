                     **—Submission—**



****Capstone-Project Reference Links****

## Links:

Github URL:  https://github.com/Dhiraj-Shivade/devops-build.git

DockerHub URL: https://hub.docker.com/repositories/dhirajshivade

React-app URL: http://3.108.95.24:80


Comments :
Capstone Project Submission. Above URL is a google docx URL where i haved mentioned asked URL and screenshots. This docs is also available on main branch on my github. Getting started with the project i first forked the repo from remote to make the changes and clone it to the repo using 'git clone' cmd then after adding the repo to my local i have created a new branch(dev) to work and added files like dockerfile, docker-compose.yml and scripts like build.sh and deploy.sh for my jenkins to execute these scripts in the build steps via CI/CD. I also added and tried to install some dependencies that i later mentioned in .gitignore and .dockerignore because we were given the built app only thats why that build folder was there means it comes after building only. Coming to dockerfile i have mentioned the base image as nginx to deploy my app and copy the source code from current directory and expose it on port 80 on container and given CMD to start my nginx server. In docker-compose.yml file, ihave mentioned my dockerfile and where it should(port) map on my host system (ec2). So i mapped port 80 of my host i.e. ec2 to port 80 on the container as we were told. Before build.sh, i have added some pre build step with conditional to identify on which branch push is done. If its dev branch go for the dev repo(public) of dockerhub and if not dev, check for main and check for any merge commit to trigger the build and push the image to the prod repo(private) on dockerhub. For that i have configured webhook to trigger build in jenkins for every push and also configured github server with dev and main branch and dockerhub for pushing the image. I have used the credentials as secret text and also used that as a ENV variable like GITHUB_USERNAME, GITHUB_PASSWORD, DOCKER_USERNAME, DOCKER_PASSWORD, DOCKER_DEV_REPO, DOCKER_PROD_REPO and given the credentials in input. In build after detecting the push from dev branch it should build the image and tag it and push it to the dev repo on dockerhub and if push is on the main then check the git log for latest commit as Merge branch 'dev' and then build tag and push it to prod repo. Before deploy script i have also used conditionals to identify the repo on which image was pushed and then wherever pushed whether on dev or prod then pull the image and deploy it in the container. I have mentioned the command, comments and echo statements to understand the script easily and to easily see if my job fails and where it is failing. I have also included all the screenshots in above link. After deploying it in container i check whether my app is accessible or not it was accessible and then i have set up monitoring. Before monitoring i walk you through the security group, i have mentioned ports like 80 (to access the deployed app), 22 (login through my own ip), 8080 (to access jenkins), 9090 (to access prometheus), 9093 (to access aletrmanager), 9100(node exporter to scrape instance level metrics) 9115( blackbox exporter to scrape metrics based on http status code for my app), 3000 (to run grafana). All these were instaIled on ec2. I have configured my prometheus with node exporter, blackbox exporter, grafana. I have defined the scrape config and my targets in prometheus.yml and alert rules in my alert.rules to send me alert when my app goes down either due to stopping container, node exporter or instance. In alertmanager.yml file i have defined smtp config and my test email i.e. test.jenkins000@g,ail.com using app password to receive the notification email when app goes down. I have also defined YAML configuration for blackbox and node exporter to know what metrics it should scrape. After my app goes down more than 1 minute every time i get alert email. And finally in grafana i have run custom queries and created a custom dashboard to see the health status(also showing in prometheus target as 'up') and scrape mertics. And for ec2 i have set my public ip attached to elastic ip. Because every down causes change in public ip and i again need to reconfigure all the things with that ip. All the commands are mentioned in the script and build steps and all the links, image name and container ID asked are in google docx and echo statements and comments to understand it better.
